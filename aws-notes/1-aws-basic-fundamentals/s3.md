# Amazon S3

- Amazon S3 is one of the main building blocks of AWS, AWS's highly scalable, durable, and secure object storage service, often advertised as "infinitely scalable" storage.

## **S3 Buckets**
- **Definition**: Containers for storing objects (files).
- **Key Features**:
  - Buckets must have a **globally unique name**.
  - Buckets are region-specific.
- **Naming Conventions**:
  - Only lowercase letters, numbers, and hyphens.
  - No underscores or uppercase letters.
  - Length: 3–63 characters.
  - Must not resemble an IP address.
  - Must start with a lowercase letter or number.

## S3 Objects

- In a bucket, an object is a file.
- Objects have a **key** as an identifier, which is the full path of the file:
    - `s3://my-bucket/my_file.txt`
    - `s3://my-bucket/my_folder/another_folder/my_file.txt`
- The key is composed of the *prefix* + **object name**:
    - `s3://my-bucket/my_folder/another_folder/my_file.txt`
- In S3, there is no concept of directories within buckets—just keys with long names containing slashes ("/").
- Object values are the content of the body:
    - Maximum object size is 5TB.
    - For uploads larger than 5TB, use **multi-part upload**.
- Each object can have metadata: a list of text key/value pairs (system or user-added).
- Each object can have tags: Unicode key/value pairs, useful for security and lifecycle. A bucket can have up to 10 tags.
- If versioning is enabled, each object has a version ID.

## S3 Versioning

- Files can have versions in S3; versioning is enabled at the bucket level.
- Uploading a file with the same key (filename) creates a new version; the existing file is not overwritten.
- Best practices for versioning:
    - Protect files against unintended deletions.
    - Roll back files to previous versions.
- Notes:
    - Files not versioned prior to enabling versioning will have a version "null."
    - Suspending versioning does not delete previous file versions.
- Deleting versioned files:
    - Deleting a versioned file adds a delete marker, but the file is not removed.
    - The file can be restored by deleting the delete marker.
    - Deleting both the delete marker and the file is a **permanent delete**, meaning the file cannot be restored.

## S3 Security

### Encryption at Rest

- AWS provides 4 methods of encryption for objects in S3:
    1. SSE-S3: encrypts objects using keys handled and managed by AWS.
    2. SSE-KMS: leverages AWS Key Management Service (KMS) to manage encryption keys.
    3. SSE-C: encryption keys are managed by the user.
    4. Client-Side Encryption: data is encrypted by the user before uploading to S3.

#### SSE-S3
- Keys used for encryption are managed by Amazon S3.
- Objects are encrypted on the server side using AES-256 encryption.
- To enable SSE-S3 encryption, set the header: `x-amz-server-side-encryption: AES256`.

#### SSE-KMS
- Encryption keys are handled and managed by AWS KMS.
- KMS provides audit trails to track key usage.
- Objects are encrypted on the server side.
- To enable SSE-KMS encryption, set the header: `x-amz-server-side-encryption: aws:kms`.

#### SSE-C
- Server-side encryption uses data keys provided by the user.
- Amazon S3 does not store the encryption key provided by the user.
- Data must be transmitted via HTTPS, as the key is sent to AWS.
- The encryption key must be provided in the request header for every operation.

#### Client-Side Encryption
- Data is encrypted before sending it to S3.
- Typically achieved using a third-party encryption library (e.g., Amazon S3 Encryption Client).
- The user is responsible for encryption, decryption, and key management.

### Encryption in Transit (SSL/TLS)

- Amazon S3 provides:
    - HTTP endpoints for non-encrypted data.
    - HTTPS endpoints for encrypted data transmission using SSL/TLS.
- Most S3 clients default to HTTPS.
- For SSE-C encryption, HTTPS is mandatory.

### S3 Security Overview

- **User-Based Security:**
    - Implemented using IAM policies to specify allowed API calls for a user.
- **Resource-Based Security:**
    - Bucket policies: JSON-based documents with bucket-wide rules, allowing cross-account access if needed.
    - Object and Bucket Access Control Lists (ACLs): Enable fine-grained access control.

**Note:** An IAM principal can access an S3 object if:
    - The user's IAM permissions allow it, or
    - The resource policy allows it, and
    - There is no explicit deny.

### S3 Bucket Policies

- Bucket policies are JSON documents applied to buckets and their objects.
- A policy's effect can be "Allow" or "Deny."
- The principal specifies the account or user the policy applies to.
- Common use cases:
    - Grant public access to the bucket.
    - Enforce encryption during upload.
    - Enable cross-account access.

### Block Public Access Settings

- Designed to block public access to buckets and objects to prevent data leaks.
- S3 provides 4 block public access settings:
    - Block new ACLs and public ACLs.
    - Block public bucket policies.
    - Block cross-account public access through any policies.

### Other Security Features

- **Networking:**
    - S3 supports VPC endpoints for instances in VPCs without internet access.
- **Logging and Auditing:**
    - S3 Access Logs can be stored in another S3 bucket.
    - API calls can be logged via AWS CloudTrail.
- **User Security:**
    - MFA Delete can be required in versioned buckets to prevent accidental deletions.
    - Pre-Signed URLs: URLs valid for a limited time.

## S3 Websites

- S3 can host static websites accessible from the internet.
- Example website URLs:
    - `<bucket-name>.s3-website-<AWS-region>.amazonaws.com`
    - `<bucket-name>.s3-website.<AWS-region>.amazonaws.com`
- To resolve `403` errors, ensure the bucket policy allows public reads.

### CORS

- Cross-Origin Resource Sharing (CORS): A mechanism to allow requests to other origins while visiting one.
- Same-origin example: `http://example.com/app1` and `http://example.com/app2`.
- Different-origin example: `http://example.com` and `http://otherexample.com`.
- Requests to a different origin require the target to allow it via CORS headers (e.g., `Access-Control-Allow-Origin`).

### S3 CORS

- For cross-origin requests to an S3 bucket, enable the appropriate CORS headers.
- Requests can allow specific origins (e.g., a URL) or all origins (`*`).

## S3 Consistency Model

- S3 provides **strong read-after-write consistency**.



## **Summary**

| **Feature**              | **Details**                                                                                 |
|--------------------------|---------------------------------------------------------------------------------------------|
| **Storage Type**          | Object storage for files up to **5TB**.                                                    |
| **Security**              | Encryption (SSE-S3, SSE-KMS, SSE-C, Client-side), IAM Policies, Bucket Policies.          |
| **Access Control**        | IAM, ACLs, Bucket Policies, Pre-Signed URLs.                                               |
| **Versioning**            | Protects against unintended deletions, allows rollback to earlier versions.                |
| **Static Website Hosting**| Host static websites with public accessibility.                                            |
| **CORS**                  | Cross-origin requests supported with proper configuration.                                 |
| **Durability**            | 99.999999999% (11 nines).                                                                  |
| **Consistency Model**     | Strong read-after-write consistency.                                                       |
